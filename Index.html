<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .status-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 4px solid #4299e1;
        }

        .status-card h3 {
            color: #2d3748;
            margin-top: 0;
        }

        #subscriptionStatus {
            font-weight: bold;
            color: #38a169;
        }

        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: inline-block;
            margin: 5px;
        }

        .btn:hover {
            background: #3182ce;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f56565;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .admin-section {
            background: #fff5f5;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #fed7d7;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin: 10px 0;
            min-height: 100px;
            resize: vertical;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin: 10px 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }

        .notification.error {
            background: #f56565;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo img {
            height: 60px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1 style="color: #4299e1;">ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</h1>
        </div>

        <div class="status-card">
            <h3>ğŸ’¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
            <p id="subscriptionStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</p>
            <button class="btn" id="subscribeBtn">âœ… Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
            <button class="btn btn-danger" id="unsubscribeBtn">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</button>
        </div>

        <div class="status-card">
            <h3>ğŸ‘¥ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
            <p><strong>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> <span id="userId">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></p>
            <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</strong> <span id="notificationStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</span></p>
        </div>

        <div class="admin-section">
            <h3>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†)</h3>
            
            <div>
                <label for="notificationTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:</label>
                <input type="text" id="notificationTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±">
            </div>

            <div>
                <label for="notificationMessage">Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:</label>
                <textarea id="notificationMessage" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù‡Ù†Ø§..."></textarea>
            </div>

            <div>
                <label for="notificationUrl">Ø±Ø§Ø¨Ø· Ø¥Ø¶Ø§ÙÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <input type="text" id="notificationUrl" placeholder="https://example.com">
            </div>

            <button class="btn" id="sendToAllBtn">ğŸ“¨ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹</button>
            <button class="btn" id="testNotificationBtn">ğŸ§ª Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
        </div>
    </div>

    <div class="notification" id="successNotification">
        âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!
    </div>

    <div class="notification error" id="errorNotification">
        âŒ Ø­Ø¯Ø« Ø®Ø·Ø£!
    </div>

    <!-- OneSignal SDK -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        OneSignalDeferred.push(async function(OneSignal) {
            await OneSignal.init({
                appId: "cb47a670-5e2f-4b55-9121-29fabcdb3746",
                safari_web_id: "web.onesignal.auto.5d688423-0af1-49ae-8d78-ba60b1402925",
                notifyButton: {
                    enable: true,
                },
                allowLocalhostAsSecureOrigin: true,
            });
            
            await OneSignal.Slidedown.promptPush();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            updateUserStatus();
        });
    </script>
    
    <script>
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function updateUserStatus() {
            const subscription = await OneSignal.User.PushSubscription;
            const userId = await OneSignal.User.getId();
            
            document.getElementById('userId').textContent = userId || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            
            if (subscription.optedIn) {
                document.getElementById('subscriptionStatus').textContent = 'âœ… Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
                document.getElementById('notificationStatus').textContent = 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: âœ…';
                document.getElementById('subscriptionStatus').style.color = '#38a169';
            } else {
                document.getElementById('subscriptionStatus').textContent = 'âŒ ØºÙŠØ± Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª';
                document.getElementById('notificationStatus').textContent = 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: âŒ';
                document.getElementById('subscriptionStatus').style.color = '#f56565';
            }
        }

        // Ø²Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        document.getElementById('subscribeBtn').addEventListener('click', async () => {
            try {
                await OneSignal.Slidedown.promptPush();
                setTimeout(updateUserStatus, 1000);
                showNotification('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', true);
            }
        });

        // Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        document.getElementById('unsubscribeBtn').addEventListener('click', async () => {
            try {
                await OneSignal.User.PushSubscription.optOut();
                updateUserStatus();
                showNotification('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
            } catch (error) {
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', true);
            }
        });

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        document.getElementById('sendToAllBtn').addEventListener('click', async () => {
            const title = document.getElementById('notificationTitle').value;
            const message = document.getElementById('notificationMessage').value;
            const url = document.getElementById('notificationUrl').value;

            if (!title || !message) {
                showNotification('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±', true);
                return;
            }

            try {
                const response = await fetch('https://onesignal.com/api/v1/notifications', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Basic pa3x3hd5seaem3rfykzxw4xxo'
                    },
                    body: JSON.stringify({
                        app_id: "cb47a670-5e2f-4b55-9121-29fabcdb3746",
                        included_segments: ["All"],
                        headings: {"en": title, "ar": title},
                        contents: {"en": message, "ar": message},
                        url: url || undefined
                    })
                });

                const data = await response.json();
                if (data.id) {
                    showNotification('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
                    // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
                    document.getElementById('notificationTitle').value = '';
                    document.getElementById('notificationMessage').value = '';
                    document.getElementById('notificationUrl').value = '';
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
                }
            } catch (error) {
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', true);
                console.error(error);
            }
        });

        // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
        document.getElementById('testNotificationBtn').addEventListener('click', async () => {
            try {
                await OneSignal.Notifications.requestPermission();
                OneSignal.showSlidedownPrompt();
                
                showNotification('ğŸ“± Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ...');
            } catch (error) {
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ', true);
            }
        });

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, isError = false) {
            const notification = isError 
                ? document.getElementById('errorNotification')
                : document.getElementById('successNotification');
            
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
        setInterval(updateUserStatus, 5000);
    </script>
</body>
</html>
