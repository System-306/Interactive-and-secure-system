<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>OneSignal Notifications</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

<style>
body{font-family:tahoma;background:#f4f6f9;padding:20px}
.card{background:#fff;border-radius:10px;padding:20px;margin-bottom:20px}
button{padding:10px 15px;border:none;border-radius:6px;cursor:pointer}
.success{color:green}
.error{color:red}
</style>
</head>

<body>

<h2>ğŸ”” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª - OneSignal</h2>

<div class="card">
  <p>Ø§Ù„Ø­Ø§Ù„Ø©: <span id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...</span></p>
  <button onclick="enableNotifications()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
  <p>User ID: <span id="playerId">---</span></p>
</div>

<div class="card">
  <h3>ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±</h3>
  <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"><br><br>
  <textarea id="message" placeholder="Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±"></textarea><br><br>
  <button onclick="sendNotification()">Ø¥Ø±Ø³Ø§Ù„</button>
</div>

<div class="card">
  <h3>ğŸ“¥ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</h3>
  <div id="notifications"></div>
</div>

<script>
  /* ================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OneSignal ================== */
  const APP_ID = "cb47a670-5e2f-4b55-9121-29fabcdb3746";
  let OneSignalSDK = null;
  
  /* ================== ØªÙ‡ÙŠØ¦Ø© OneSignal ================== */
  window.OneSignalDeferred = window.OneSignalDeferred || [];
  OneSignalDeferred.push(async function(OneSignal) {
    try {
      OneSignalSDK = OneSignal;
      
      await OneSignalSDK.init({
        appId: APP_ID,
        allowLocalhostAsSecureOrigin: true
      });
      
      document.getElementById("status").innerHTML =
        "<span class='success'>Ø¬Ø§Ù‡Ø²</span>";
      
      /* Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© */
      OneSignalSDK.Notifications.addEventListener(
        "foregroundWillDisplay",
        event => {
          const n = event.notification;
          
          addNotification(
            n.title || "Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯",
            n.body || ""
          );
        }
      );
      
    } catch (e) {
      document.getElementById("status").innerHTML =
        "<span class='error'>ÙØ´Ù„ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©</span>";
      console.error(e);
    }
  });
  
  /* ================== ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ================== */
  async function enableNotifications() {
    try {
      await OneSignalSDK.Notifications.requestPermission();
      
      if (OneSignalSDK.Notifications.permission === true) {
        document.getElementById("status").innerHTML =
          "<span class='success'>Ù…ÙØ¹Ù„Ø©</span>";
        
        const id = await OneSignalSDK.User.getId();
        document.getElementById("playerId").textContent =
          id ? id : "ØºÙŠØ± Ù…ØªÙˆÙØ±";
      } else {
        throw new Error("Ø§Ù„Ø¥Ø°Ù† Ù…Ø±ÙÙˆØ¶");
      }
    } catch (e) {
      document.getElementById("status").innerHTML =
        "<span class='error'>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„</span>";
      console.error(e);
    }
  }
  
  /* ================== Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± (ØªØ­Ù‚Ù‚ Ø­Ù‚ÙŠÙ‚ÙŠ) ================== */
  async function sendNotification() {
    const title = document.getElementById("title").value.trim();
    const message = document.getElementById("message").value.trim();
    
    if (!title || !message) {
      alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Øµ");
      return;
    }
    
    try {
      const res = await fetch("send.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, message })
      });
      
      const data = await res.json();
      
      if (data.success && data.recipients > 0) {
        alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙØ¹Ù„ÙŠÙ‹Ø§");
      } else if (data.success && data.recipients === 0) {
        alert("âš ï¸ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø£ÙØ±Ø³Ù„ ÙˆÙ„ÙƒÙ† Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙƒÙŠÙ†");
      } else {
        alert("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±");
        console.error(data);
      }
      
    } catch (e) {
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
      console.error(e);
    }
  }
  
  /* ================== Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ================== */
  function addNotification(title, body) {
    const container = document.getElementById("notifications");
    
    const div = document.createElement("div");
    div.style.border = "1px solid #ddd";
    div.style.padding = "8px";
    div.style.marginBottom = "6px";
    div.innerHTML = `<strong>${title}</strong><br>${body}`;
    
    container.prepend(div);
  }
</script>

</body>
</html>
